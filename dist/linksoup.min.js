/*! linksoup - v0.1.0 - 2012-10-14
* https://github.com/automatonic/linksoup
* Copyright (c) 2012 Elliott B. Edwards; Licensed MIT */
(function(e){function n(e){function o(e){return e&&"href"in e&&e.prefix&&"proposed"in e.prefix}function u(e){return e&&!("href"in e)}function a(e){o(s)&&(t.matchMarkdownLinkSuffix.test(e)?(e=RegExp.$3,RegExp.$2&&(s.title=RegExp.$2),s.text=s.prefix.proposed.linkText,s.prefix.proposed.text?(s.prefix.text=s.prefix.proposed.text,delete s.prefix.proposed):(i.splice(i.length-2,1),s=s.prefix)):delete s.prefix.proposed,delete s.prefix),e&&(s={text:e},i.push(s))}function f(e){var n={href:e.href};u(s)&&t.matchMarkdownLinkPrefix.test(s.text)&&(s.proposed={text:RegExp.$1,linkText:RegExp.$2},n.prefix=s),s=n,i.push(s)}var n=r(e),i=[],s=null;if(n.length===0)a(e);else{var l=n[0],c=n[n.length-1];l.start>0&&a(e.substring(0,l.start));if(n.length===1)f(l);else{f(l);var h=l;for(var p=1;p<n.length;p++)n[p].start-h.end>=1&&a(e.substring(h.end,n[p].start)),f(h=n[p])}c.end<e.length&&a(e.substring(c.end))}return i}function r(e,n){n||(n={extractUrlsWithoutProtocol:!0});if(!e||(n.extractUrlsWithoutProtocol?!e.match(/\./):!e.match(/:/)))return[];var r=[];while(t.extractUrl.exec(e)){var s=RegExp.$2,o=RegExp.$4,u=RegExp.$5,a=RegExp.$7,f={href:RegExp.$3,end:t.extractUrl.lastIndex,start:t.extractUrl.lastIndex-RegExp.$3.length};if(!o){if(!n.extractUrlsWithoutProtocol||s.match(t.invalidUrlWithoutProtocolPrecedingChars))continue;var l={domain:u,cursor:f,links:r,lastLink:null,lastLinkInvalidMatch:!1,asciiEndPosition:0};u.replace(t.validAsciiDomain,i(l));if(l.lastLink===null)continue;a&&(l.lastLinkInvalidMatch&&r.push(l.lastLink),l.lastLink.href=f.href.replace(u,l.lastLink.href),l.lastLink.end=f.end)}else f.href.match(t.validTcoUrl)&&(f.href=RegExp.lastMatch,f.end=f.start+f.href.length),r.push(f)}return r}function i(e){return function(n){var r=e.domain.indexOf(n,e.asciiEndPosition);e.asciiEndPosition=r+n.length,e.lastLink={href:n,start:e.cursor.start+r,end:e.cursor.start+e.asciiEndPosition},e.lastLinkInvalidMatch=n.match(t.invalidShortDomain),e.lastLinkInvalidMatch||e.links.push(e.lastLink)}}function s(e,n){return n=n||"",typeof e!="string"&&(e.global&&n.indexOf("g")<0&&(n+="g"),e.ignoreCase&&n.indexOf("i")<0&&(n+="i"),e.multiline&&n.indexOf("m")<0&&(n+="m"),e=e.source),new RegExp(e.replace(/#\{(\w+)\}/g,function(e,n){var r=t[n]||"";return typeof r!="string"&&(r=r.source),r}),n)}function o(e,t){return e.replace(/#\{(\w+)\}/g,function(e,n){return t[n]||""})}function u(e,t,n){var r=String.fromCharCode(t);return n!==t&&(r+="-"+String.fromCharCode(n)),e.push(r),e}var t={};e.parseSpans=n,e.parseLinks=r;var a=String.fromCharCode,f=[a(32),a(133),a(160),a(5760),a(6158),a(8232),a(8233),a(8239),a(8287),a(12288)];u(f,9,13),u(f,8192,8202);var l=[a(65534),a(65279),a(65535)];u(l,8234,8238);var c=[];u(c,192,214),u(c,216,246),u(c,248,255),u(c,256,591),u(c,595,596),u(c,598,599),u(c,601,601),u(c,603,603),u(c,611,611),u(c,616,616),u(c,623,623),u(c,626,626),u(c,649,649),u(c,651,651),u(c,699,699),u(c,768,879),u(c,7680,7935),t.latinAccentChars=s(c.join("")),t.punct=new RegExp("\\!'#%&'\\(\\)*\\+,\\\\\\-\\.\\/:;<=>\\?@\\[\\]\\^_{|}~\\$"),t.spaces_group=s(f.join("")),t.invalid_chars_group=s(l.join("")),t.validUrlPrecedingChars=s("(?:[^A-Za-z0-9@＠$#＃#{invalid_chars_group}]|^)"),t.invalidUrlWithoutProtocolPrecedingChars="[\\-_\\.\\\\/]$",t.invalidDomainChars=o("#{punct}#{spaces_group}#{invalid_chars_group}",t),t.validDomainChars=s("[^#{invalidDomainChars}]"),t.validSubdomain=s("(?:(?:#{validDomainChars}(?:[_-]|#{validDomainChars})*)?#{validDomainChars}\\.)"),t.validDomainName=s("(?:(?:#{validDomainChars}(?:-|#{validDomainChars})*)?#{validDomainChars}\\.)"),t.validGTLD=s("(?:(?:aero|asia|biz|cat|com|coop|edu|gov|info|int|jobs|mil|mobi|museum|name|net|org|pro|tel|travel|xxx)(?=[^0-9a-zA-Z]|$))"),t.validCCTLD=s("(?:(?:ac|ad|ae|af|ag|ai|al|am|an|ao|aq|ar|as|at|au|aw|ax|az|ba|bb|bd|be|bf|bg|bh|bi|bj|bm|bn|bo|br|bs|bt|bv|bw|by|bz|ca|cc|cd|cf|cg|ch|ci|ck|cl|cm|cn|co|cr|cs|cu|cv|cx|cy|cz|dd|de|dj|dk|dm|do|dz|ec|ee|eg|eh|er|es|et|eu|fi|fj|fk|fm|fo|fr|ga|gb|gd|ge|gf|gg|gh|gi|gl|gm|gn|gp|gq|gr|gs|gt|gu|gw|gy|hk|hm|hn|hr|ht|hu|id|ie|il|im|in|io|iq|ir|is|it|je|jm|jo|jp|ke|kg|kh|ki|km|kn|kp|kr|kw|ky|kz|la|lb|lc|li|lk|lr|ls|lt|lu|lv|ly|ma|mc|md|me|mg|mh|mk|ml|mm|mn|mo|mp|mq|mr|ms|mt|mu|mv|mw|mx|my|mz|na|nc|ne|nf|ng|ni|nl|no|np|nr|nu|nz|om|pa|pe|pf|pg|ph|pk|pl|pm|pn|pr|ps|pt|pw|py|qa|re|ro|rs|ru|rw|sa|sb|sc|sd|se|sg|sh|si|sj|sk|sl|sm|sn|so|sr|ss|st|su|sv|sy|sz|tc|td|tf|tg|th|tj|tk|tl|tm|tn|to|tp|tr|tt|tv|tw|tz|ua|ug|uk|us|uy|uz|va|vc|ve|vg|vi|vn|vu|wf|ws|ye|yt|za|zm|zw)(?=[^0-9a-zA-Z]|$))"),t.validPunycode=s(/(?:xn--[0-9a-z]+)/),t.validDomain=s("(?:#{validSubdomain}*#{validDomainName}(?:#{validGTLD}|#{validCCTLD}|#{validPunycode}))"),t.validAsciiDomain=s(new RegExp("(?:(?:[a-z0-9#{latinAccentChars}]+)\\.)+(?:#{validGTLD}|#{validCCTLD}|#{validPunycode})","gi")),t.invalidShortDomain=s("^#{validDomainName}#{validCCTLD}$"),t.validPortNumber=s(/[0-9]+/),t.validGeneralUrlPathChars=s(new RegExp("[a-z0-9!\\*';:=\\+,\\.\\$\\/%#\\[\\]\\-_~|&#{latinAccentChars}]","i")),t.validUrlBalancedParens=s(new RegExp("\\(#{validGeneralUrlPathChars}+\\)","i")),t.validUrlPathEndingChars=s(new RegExp("[\\+\\-a-z0-9=_#\\/#{latinAccentChars}]|(?:#{validUrlBalancedParens})","i")),t.validUrlPath=s("(?:(?:#{validGeneralUrlPathChars}*(?:#{validUrlBalancedParens}#{validGeneralUrlPathChars}*)*#{validUrlPathEndingChars})|(?:@#{validGeneralUrlPathChars}+/))","i"),t.validUrlQueryChars=/[a-z0-9!?\*'\(\);:&=\+\$\/%#\[\]\-_\.,~|]/i,t.validUrlQueryEndingChars=/[a-z0-9_&=#\/]/i,t.matchMarkdownLinkPrefix=/^(.*)\[([^\]]*)\]\s*\(\s*$/i,t.matchMarkdownLinkSuffix=/^\s*("([^"]*)")?\s*\)(.*)$/i,t.extractUrl=s("((#{validUrlPrecedingChars})((https?:\\/\\/)?(#{validDomain})(?::(#{validPortNumber}))?(\\/#{validUrlPath}*)?(\\?#{validUrlQueryChars}*#{validUrlQueryEndingChars})?))","gi"),t.validTcoUrl=/^https?:\/\/t\.co\/[a-z0-9]+/i})(typeof exports=="undefined"?this.linksoup={}:exports);